<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pong Retro Mejorado</title>
  <style>
    body { 
      text-align: center; 
      font-family: Arial, sans-serif; 
      background: #000; 
      color: #fff;
      margin: 0;
      padding: 20px;
    }
    canvas { 
      background: #222; 
      display: block; 
      margin: 20px auto; 
      border: 2px solid #fff; 
    }
  </style>
</head>
<body>
  <h1>Pong Retro Mejorado</h1>
  <canvas id="gameCanvas" width="600" height="400"></canvas>
  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    // Propiedades de la paleta
    const paddleWidth = 10;
    const paddleHeight = 80;
    let playerY = (canvas.height - paddleHeight) / 2;
    let aiY = (canvas.height - paddleHeight) / 2;
    let paddleSpeed = 5; // Velocidad del jugador (constante)
    let aiSpeed = 5;     // Velocidad de la IA

    // Propiedades de la bola
    let ballX = canvas.width / 2;
    let ballY = canvas.height / 2;
    const ballRadius = 8;
    let ballSpeedX = 4;
    let ballSpeedY = 4;

    // Variables del juego
    let playerLives = 3;
    let score = 0;
    let level = 1;
    let nextLevelScore = 5; // Cada 5 puntos se sube de nivel

    // Variables de entrada del jugador
    let upPressed = false;
    let downPressed = false;

    // Detectar eventos de teclado
    document.addEventListener("keydown", (e) => {
      if (e.key === "ArrowUp") {
        upPressed = true;
      } else if (e.key === "ArrowDown") {
        downPressed = true;
      }
    });

    document.addEventListener("keyup", (e) => {
      if (e.key === "ArrowUp") {
        upPressed = false;
      } else if (e.key === "ArrowDown") {
        downPressed = false;
      }
    });

    // Dibujar paleta
    function drawPaddle(x, y) {
      ctx.fillStyle = "#fff";
      ctx.fillRect(x, y, paddleWidth, paddleHeight);
    }

    // Dibujar la bola
    function drawBall() {
      ctx.beginPath();
      ctx.arc(ballX, ballY, ballRadius, 0, Math.PI * 2);
      ctx.fillStyle = "#fff";
      ctx.fill();
      ctx.closePath();
    }

    // Dibujar la red central y la información del juego (vidas, puntos y nivel)
    function drawUI() {
      // Red central
      ctx.fillStyle = "#fff";
      const netWidth = 2;
      const netHeight = 10;
      for (let i = 0; i < canvas.height; i += 15) {
        ctx.fillRect((canvas.width - netWidth) / 2, i, netWidth, netHeight);
      }
      // Información
      ctx.font = "16px Arial";
      ctx.fillText("Vidas: " + playerLives, 20, 20);
      ctx.fillText("Puntos: " + score, canvas.width / 2 - 30, 20);
      ctx.fillText("Nivel: " + level, canvas.width - 100, 20);
    }

    // Movimiento de las paletas
    function movePaddles() {
      // Movimiento del jugador
      if (upPressed && playerY > 0) {
        playerY -= paddleSpeed;
      }
      if (downPressed && playerY < canvas.height - paddleHeight) {
        playerY += paddleSpeed;
      }
      // Movimiento de la IA: seguimiento simple de la bola
      if (aiY + paddleHeight / 2 < ballY) {
        aiY += aiSpeed;
      } else if (aiY + paddleHeight / 2 > ballY) {
        aiY -= aiSpeed;
      }
      // Limitar la paleta de la IA dentro del canvas
      if (aiY < 0) aiY = 0;
      if (aiY > canvas.height - paddleHeight) aiY = canvas.height - paddleHeight;
    }

    // Actualizar la posición de la bola y gestionar colisiones
    function moveBall() {
      ballX += ballSpeedX;
      ballY += ballSpeedY;

      // Rebote en la parte superior e inferior
      if (ballY + ballRadius > canvas.height || ballY - ballRadius < 0) {
        ballSpeedY = -ballSpeedY;
      }

      // Colisión con la paleta del jugador (lado izquierdo)
      if (ballX - ballRadius < paddleWidth) {
        if (ballY > playerY && ballY < playerY + paddleHeight) {
          ballSpeedX = -ballSpeedX;
          let deltaY = ballY - (playerY + paddleHeight / 2);
          ballSpeedY = deltaY * 0.2;
        } else {
          // El jugador falla: pierde una vida
          playerLives--;
          if (playerLives <= 0) {
            alert("Game Over! Has perdido todas tus vidas.");
            resetGame();
            return;
          }
          resetBall();
          return;
        }
      }

      // Colisión con la paleta de la IA (lado derecho)
      if (ballX + ballRadius > canvas.width - paddleWidth) {
        if (ballY > aiY && ballY < aiY + paddleHeight) {
          ballSpeedX = -ballSpeedX;
          let deltaY = ballY - (aiY + paddleHeight / 2);
          ballSpeedY = deltaY * 0.2;
        } else {
          // El jugador anota un punto
          score++;
          if (score >= nextLevelScore) {
            level++;
            nextLevelScore += 5;
            // Aumenta la dificultad: incrementa la velocidad de la bola y de la IA
            ballSpeedX *= 1.2;
            ballSpeedY *= 1.2;
            aiSpeed += 1;
          }
          resetBall();
          return;
        }
      }
    }

    // Reinicia la posición de la bola (manteniendo la velocidad actual)
    function resetBall() {
      ballX = canvas.width / 2;
      ballY = canvas.height / 2;
      // Invertir la dirección X para que la bola se lance hacia el lado contrario
      ballSpeedX = (ballSpeedX > 0) ? -Math.abs(ballSpeedX) : Math.abs(ballSpeedX);
      // Dar un pequeño impulso aleatorio en Y
      ballSpeedY = 4 * (Math.random() > 0.5 ? 1 : -1);
    }

    // Reiniciar el juego completo
    function resetGame() {
      playerLives = 3;
      score = 0;
      level = 1;
      nextLevelScore = 5;
      ballSpeedX = 4;
      ballSpeedY = 4;
      aiSpeed = 5;
      resetBall();
    }

    // Función principal de dibujo y actualización
    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawUI();
      drawPaddle(0, playerY);                     // Paleta del jugador (izquierda)
      drawPaddle(canvas.width - paddleWidth, aiY);  // Paleta de la IA (derecha)
      drawBall();
      movePaddles();
      moveBall();
      requestAnimationFrame(draw);
    }

    draw();
  </script>
</body>
</html>
